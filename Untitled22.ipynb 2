{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Clean0_30sec201904GCN8.xls\n",
      "Clean1_30sec201904GCN8.xls\n",
      "Clean2_30sec201904GCN8.xls\n",
      "Clean3_30sec201904GCN8.xls\n",
      "Clean4_30sec201904GCN8.xls\n",
      "Clean5_30sec201904GCN8.xls\n",
      "Clean6_30sec201904GCN8.xls\n",
      "Clean7_30sec201904GCN8.xls\n",
      "mode 3 short in\n",
      "20190722  08:24:00\n",
      "-1\n",
      "------------------------------\n",
      "Clean8_30sec201904GCN8.xls\n",
      "20190722  20:09:30\n",
      "1\n",
      "------------------------------\n",
      "Clean9_30sec201904GCN8.xls\n",
      "Clean10_30sec201904GCN8.xls\n",
      "Clean11_30sec201904GCN8.xls\n",
      "mode 1 long in\n",
      "20190723  21:29:30\n",
      "1\n",
      "------------------------------\n",
      "Clean12_30sec201904GCN8.xls\n",
      "20190724  03:38:00\n",
      "-1\n",
      "------------------------------\n",
      "Clean13_30sec201904GCN8.xls\n",
      "Clean14_30sec201904GCN8.xls\n",
      "Clean15_30sec201904GCN8.xls\n",
      "mode 2 short in\n",
      "20190725  08:33:30\n",
      "-1\n",
      "------------------------------\n",
      "FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF\n",
      "20190725  09:45:30\n",
      "1\n",
      "------------------------------\n",
      "Clean16_30sec201904GCN8.xls\n",
      "Clean17_30sec201904GCN8.xls\n",
      "Clean18_30sec201904GCN8.xls\n",
      "mode 3 short in\n",
      "20190726  06:30:00\n",
      "-1\n",
      "------------------------------\n",
      "20190726  08:31:00\n",
      "1\n",
      "------------------------------\n",
      "Clean19_30sec201904GCN8.xls\n",
      "Clean20_30sec201904GCN8.xls\n",
      "Clean21_30sec201904GCN8.xls\n",
      "mode 1 long in\n",
      "20190729  15:29:30\n",
      "1\n",
      "------------------------------\n",
      "Clean22_30sec201904GCN8.xls\n",
      "Clean23_30sec201904GCN8.xls\n",
      "Clean24_30sec201904GCN8.xls\n",
      "20190730  14:02:00\n",
      "-1\n",
      "------------------------------\n",
      "Clean25_30sec201904GCN8.xls\n",
      "Clean26_30sec201904GCN8.xls\n",
      "Clean27_30sec201904GCN8.xls\n",
      "Clean28_30sec201904GCN8.xls\n",
      "Clean29_30sec201904GCN8.xls\n",
      "mode 1 long in\n",
      "20190801  13:59:30\n",
      "1\n",
      "------------------------------\n",
      "Clean30_30sec201904GCN8.xls\n",
      "20190801  15:10:30\n",
      "-1\n",
      "------------------------------\n",
      "Clean31_30sec201904GCN8.xls\n",
      "Clean32_30sec201904GCN8.xls\n",
      "Clean33_30sec201904GCN8.xls\n",
      "Clean34_30sec201904GCN8.xls\n",
      "Clean35_30sec201904GCN8.xls\n",
      "Clean36_30sec201904GCN8.xls\n",
      "Clean37_30sec201904GCN8.xls\n",
      "mode 1 short in\n",
      "20190806  03:59:30\n",
      "-1\n",
      "------------------------------\n",
      "Clean38_30sec201904GCN8.xls\n",
      "###\n",
      "20190806  19:53:00\n",
      "1\n",
      "------------------------------\n",
      "Clean39_30sec201904GCN8.xls\n",
      "Clean40_30sec201904GCN8.xls\n",
      "Clean41_30sec201904GCN8.xls\n",
      "Clean42_30sec201904GCN8.xls\n",
      "mode 3 long in\n",
      "20190808  04:43:30\n",
      "1\n",
      "------------------------------\n",
      "Clean43_30sec201904GCN8.xls\n",
      "###\n",
      "20190808  08:58:30\n",
      "-1\n",
      "------------------------------\n",
      "mode 3 long in\n",
      "20190808  12:59:00\n",
      "1\n",
      "------------------------------\n",
      "20190808  13:43:30\n",
      "-1\n",
      "------------------------------\n",
      "Clean44_30sec201904GCN8.xls\n",
      "Clean45_30sec201904GCN8.xls\n",
      "mode 3 long in\n",
      "20190809  08:10:00\n",
      "1\n",
      "------------------------------\n",
      "###\n",
      "20190809  08:29:00\n",
      "-1\n",
      "------------------------------\n",
      "mode 1 short in\n",
      "20190809  08:34:00\n",
      "-1\n",
      "------------------------------\n",
      "Clean46_30sec201904GCN8.xls\n",
      "Clean47_30sec201904GCN8.xls\n",
      "20190812  02:37:00\n",
      "1\n",
      "------------------------------\n",
      "Clean48_30sec201904GCN8.xls\n",
      "mode 1 long in\n",
      "20190812  05:59:30\n",
      "1\n",
      "------------------------------\n",
      "Clean49_30sec201904GCN8.xls\n",
      "20190812  14:42:30\n",
      "-1\n",
      "------------------------------\n",
      "Clean50_30sec201904GCN8.xls\n",
      "Clean51_30sec201904GCN8.xls\n",
      "Clean52_30sec201904GCN8.xls\n",
      "Clean53_30sec201904GCN8.xls\n",
      "Clean54_30sec201904GCN8.xls\n",
      "mode 1 long in\n",
      "20190814  07:59:30\n",
      "1\n",
      "------------------------------\n",
      "20190814  11:15:00\n",
      "-1\n",
      "------------------------------\n",
      "Clean55_30sec201904GCN8.xls\n",
      "Clean56_30sec201904GCN8.xls\n",
      "mode 3 long in\n",
      "20190815  02:34:30\n",
      "1\n",
      "------------------------------\n",
      "20190815  04:59:00\n",
      "-1\n",
      "------------------------------\n",
      "Clean57_30sec201904GCN8.xls\n",
      "Clean58_30sec201904GCN8.xls\n",
      "Clean59_30sec201904GCN8.xls\n",
      "Clean60_30sec201904GCN8.xls\n",
      "profit:52.1000000000015\n",
      "number52\n",
      "tot:5086.76000000015\n",
      "Position:0\n",
      "MDD:-16.09999999999991\n",
      "2\n",
      "Win:11\n",
      "Los:3\n",
      "Neutral:0\n",
      "Sharpe:6.808262702093516\n",
      "20190816  16:59:30\n"
     ]
    }
   ],
   "source": [
    "import os\n",
    "import numpy as np\n",
    "import xlrd\n",
    "import statistics \n",
    "import xlrd\n",
    "import math\n",
    "from datetime import datetime\n",
    "from datetime import date, timedelta\n",
    "xda=[]\n",
    "pdi14=[]\n",
    "ndi14=[]\n",
    "diff=[]\n",
    "TR14=[]\n",
    "kStochastic=[]\n",
    "ATR=[]\n",
    "duration=[]\n",
    "def Maximum(l):\n",
    "    k=-1\n",
    "    for e in l:\n",
    "        if e>k:\n",
    "            k=e\n",
    "    return k\n",
    "def minimum(l):\n",
    "    k=3000\n",
    "    for e in l:\n",
    "        if e<k:\n",
    "            k=e\n",
    "    return k   \n",
    "def mena_diff(sma_20_TP, inp):\n",
    "    return abs(sma_20_TP-inp)\n",
    "    \n",
    "def run():\n",
    "    global ATR\n",
    "    #ATR=[]\n",
    "    global TR14\n",
    "    global diff\n",
    "    global xda\n",
    "    period_10 = 10\n",
    "    period_20 = 20\n",
    "    MA10 = []\n",
    "    MA240 = []\n",
    "    MA320 = []\n",
    "    avei=0\n",
    "    aveii=0\n",
    "    Position=0\n",
    "    mPosition_1HR=0\n",
    "    unrealised=0\n",
    "    mem=0\n",
    "    ma1=[]\n",
    "    number=0\n",
    "    diff=0\n",
    "    profit=0\n",
    "    tmp = []\n",
    "    Bid_k =0\n",
    "    Ask_k =0\n",
    "    Bid_j =0\n",
    "    Ask_j =0\n",
    "\n",
    "    Now=\"\"\n",
    "    direction=0\n",
    "    f=0\n",
    "    count=0\n",
    "    h=0\n",
    "    light=0\n",
    "    period_5=3\n",
    "    MA5=[]\n",
    "    ma5_j = 0\n",
    "    ma5_k = 0\n",
    "    step1=0\n",
    "    step2=0\n",
    "    c=0#356#0\n",
    "    h=-1000\n",
    "    l_=4000\n",
    "    bias=[]\n",
    "    bb=[]\n",
    "    membias=0\n",
    "    MD=3000\n",
    "    counter=0\n",
    "    \n",
    "    c=0\n",
    "    counter=0\n",
    "\n",
    "    I=0\n",
    "    \n",
    "    hr_o=[]\n",
    "    hr_oc=0\n",
    "    hr_h=[]\n",
    "    hr_hc=0\n",
    "    hr_l=[]\n",
    "    hr_lc=10000\n",
    "    hr_c=[]\n",
    "    hr_cc=0\n",
    "    hr_counter=0\n",
    "    mprice=[]\n",
    "    period=20\n",
    "    vvv=[]\n",
    "    wwwma=[]\n",
    "    www=[]\n",
    "    y1=[]\n",
    "    y2=[]\n",
    "    y3=[]\n",
    "    y0=[]\n",
    "    stop=0\n",
    "    III=0\n",
    "    MDD=0\n",
    "    axda=[]\n",
    "    maprice=[]\n",
    "    ma=[]\n",
    "    n=1\n",
    "    N=1\n",
    "    initial=9500\n",
    "    bbw = []\n",
    "    RS = []\n",
    "    RSI = []\n",
    "    maRSI = []\n",
    "    SlowStoc = []\n",
    "    SlowStocVal = []\n",
    "    Fisher = []\n",
    "    maFisher = []\n",
    "    DC_up= []\n",
    "    DC_down = []\n",
    "    DC_mid= []\n",
    "    Win=0\n",
    "    Los=0\n",
    "    Neutral=0\n",
    "    mPosition=0\n",
    "\n",
    "    \n",
    "    Pn=[]\n",
    "    Switch=0\n",
    "    Maxxx=0\n",
    "    Minnn=10000\n",
    "    Maxx=0\n",
    "    Minn=10000\n",
    "    waiting=0\n",
    "    stop=0\n",
    "    counter=0\n",
    "    \n",
    "    TR=[]\n",
    "    pdm1=[]\n",
    "    ndm1=[]\n",
    "    TR14=[]\n",
    "    pdm14=[]\n",
    "    ndm14=[]\n",
    "    global pdi14\n",
    "    global ndi14\n",
    "    di14diff=[]\n",
    "    di14sum=[]\n",
    "    xd=[]\n",
    "    xda=[]\n",
    "    TP = []\n",
    "    SMA20_TP = []\n",
    "    hr_o=[]\n",
    "    hr_oc=0\n",
    "    hr_h=[]\n",
    "    hr_hc=0\n",
    "    hr_l=[]\n",
    "    hr_lc=10000\n",
    "    hr_c=[]\n",
    "    hr_cc=0\n",
    "    hr_counter=0\n",
    "    time_scale_counter=0\n",
    "    mode=0\n",
    "    BB=[]\n",
    "    BB_counter=0\n",
    "    BBprice=[]\n",
    "    \n",
    "    Stochastic_High=[]\n",
    "    Stochastic_Low=[]\n",
    "    Stochastic_HH=[]\n",
    "    Stochastic_LL=[]\n",
    "    Stochastic_CC=[]\n",
    "    #kStochastic=[]\n",
    "    dStochastic=[]\n",
    "    vStochastic_High=0\n",
    "    vStochastic_Low=100000\n",
    "    global kStochastic\n",
    "    global duration\n",
    "    #duration=[]\n",
    "    duration_c=0\n",
    "    #Time=datetime.now().strftime(\"%Y%m%d %H:%M:%S.%f\")\n",
    "    #yesterday=str(int(Time[6:8])-1)######################## to do\n",
    "    while c<418:\n",
    "        \n",
    "        fs=\"Clean\"+str(c)+\"_30sec\"+\"201904GCN8.xls\"\n",
    "        if os.path.isfile(fs):\n",
    "            print(fs)\n",
    "            book = xlrd.open_workbook(fs)\n",
    "            sh = book.sheet_by_index(0)\n",
    "            i = 0\n",
    "            while i<sh.nrows:\n",
    "\n",
    "                Now=sh.cell_value(rowx=i, colx=0)\n",
    "                Ask_j = Ask_k\n",
    "                Bid_j = Bid_k\n",
    "                Bid_k = float(sh.cell_value(rowx=i, colx=4))\n",
    "                Ask_k = float(sh.cell_value(rowx=i, colx=9))\n",
    "                tot=100*profit-(2.37*number)+initial\n",
    "                #maprice.append((Bid_k+Ask_k)/2)\n",
    "                maprice.append(Ask_k)\n",
    "                if len(maprice)>=1440:\n",
    "                    ma.append(np.mean(maprice[-2400:]))\n",
    "                    #BB.append(statistics.stdev(maprice[-2400:]))\n",
    "                    ma1.append(np.mean(maprice[-20:]))\n",
    "                if BB_counter==1:\n",
    "                    BB_counter=0\n",
    "                    BBprice.append(Ask_k)\n",
    "                    if len(BBprice)>=1200:\n",
    "                        BB.append(statistics.stdev(BBprice[-1200:]))\n",
    "                else:\n",
    "                    BB_counter+=1   \n",
    "                \"\"\"if maprice[-1]>vStochastic_High:\n",
    "                    vStochastic_High= maprice[-1]\n",
    "                if maprice[-1]<vStochastic_Low:\n",
    "                    vStochastic_Low=maprice[-1]\"\"\"\n",
    "                if True:#int((datetime_object_2-datetime_object_1).total_seconds())%480==0:\n",
    "                    Stochastic_High.append(vStochastic_High)\n",
    "                    vStochastic_High=0\n",
    "                    Stochastic_Low.append(vStochastic_Low)\n",
    "                    vStochastic_Low=100000\n",
    "                    T_=14*2*5\n",
    "                    if len(Stochastic_Low)>T_:\n",
    "                        Stochastic_HH.append(Maximum(Stochastic_High[-T_:]))\n",
    "                        Stochastic_LL.append(minimum(Stochastic_Low[-T_:]))\n",
    "                        Stochastic_CC.append(maprice[-1])\n",
    "                        if (Stochastic_HH[-1]-Stochastic_LL[-1])!=0:\n",
    "                            kStochastic.append(100*((Stochastic_CC[-1]-Stochastic_LL[-1])/(Stochastic_HH[-1]-Stochastic_LL[-1])))\n",
    "                        else:\n",
    "                            kStochastic.append(100)\n",
    "                        if len(kStochastic)>2:\n",
    "                            dStochastic.append(np.mean(kStochastic[-3]))\n",
    "                c_h=(float(sh.cell_value(rowx=i, colx=7)))#/2\n",
    "                c_l=(float(sh.cell_value(rowx=i, colx=8)))#/2\n",
    "                if c_h>hr_hc:\n",
    "                    hr_hc=c_h\n",
    "                if c_l<hr_lc:\n",
    "                    hr_lc=c_l   \n",
    "                time_scale_counter+=1\n",
    "                if time_scale_counter==60:#(480):\n",
    "                    hr_oc=hr_cc\n",
    "                    hr_cc=(float(sh.cell_value(rowx=i, colx=9)))#/2 float(sh.cell_value(rowx=i, colx=4))+\n",
    "                    hr_o.append(hr_oc)\n",
    "                    hr_c.append(hr_cc)\n",
    "                    hr_l.append(hr_lc)\n",
    "                    hr_lc=10000\n",
    "                    hr_h.append(hr_hc)\n",
    "                    hr_hc=0\n",
    "                    time_scale_counter=0\n",
    "                    \n",
    "                    if len(hr_l)>1 and len(hr_h)>1 and len(hr_c)>1:\n",
    "                    \n",
    "                        #dmi\n",
    "                        val_a=hr_h[-1]-hr_l[-1]\n",
    "                        val_b=abs(hr_h[-1]-hr_c[-2])\n",
    "                        val_c=abs(hr_l[-1]-hr_c[-2])\n",
    "                        tmp_list=[val_a,val_b,val_c]\n",
    "                        tmp=Maximum(tmp_list)\n",
    "                        if tmp>0:\n",
    "                            TR.append(tmp)\n",
    "                        if (hr_h[-1]-hr_h[-2])>(hr_l[-2]-hr_l[-1]):\n",
    "                            tmp_list=[0,(hr_h[-1]-hr_h[-2])]\n",
    "                            pdm1.append(Maximum(tmp_list))\n",
    "                        else:\n",
    "                            pdm1.append(0)\n",
    "                        if (hr_h[-1]-hr_h[-2])<(hr_l[-2]-hr_l[-1]):\n",
    "                            tmp_list=[0,(hr_l[-2]-hr_l[-1])]\n",
    "                            ndm1.append(Maximum(tmp_list))\n",
    "                        else:\n",
    "                            ndm1.append(0)\n",
    "                        dmi_length=56#14#3360 #4hr*14*60min/15\n",
    "                    \n",
    "                        ################# period=14 per 30 sec \n",
    "                        if len(pdm1)>=dmi_length and len(TR)>=dmi_length and len(pdm14)==0:\n",
    "                        \n",
    "                            TR14.append(sum(i for i in (TR[-dmi_length:])))\n",
    "                            ATR.append(TR14[-1]/dmi_length)\n",
    "                            pdm14.append(sum(i for i in (pdm1[-dmi_length:])))\n",
    "                            ndm14.append(sum(i for i in (ndm1[-dmi_length:])))\n",
    "                        elif len(pdm1)>dmi_length and len(pdm14)>0:\n",
    "                            tmp_val=TR14[-1]-(TR14[-1]/dmi_length)+TR[-1]\n",
    "                            TR14.append(tmp_val)\n",
    "                            ATR.append(TR14[-1]/dmi_length)\n",
    "                            tmp_val=pdm14[-1]-(pdm14[-1]/dmi_length)+pdm1[-1]\n",
    "                            pdm14.append(tmp_val)\n",
    "                            tmp_val=ndm14[-1]-(ndm14[-1]/dmi_length)+ndm1[-1]\n",
    "                            ndm14.append(tmp_val)\n",
    "                        if len(TR14)>0 and len(pdm14)>0:\n",
    "                            pdi14.append(100*(pdm14[-1]/TR14[-1]))\n",
    "                        if len(TR14)>0 and len(ndm14)>0:\n",
    "                            ndi14.append(100*(ndm14[-1]/TR14[-1]))\n",
    "                        if len(pdi14)>0:\n",
    "                            di14diff.append(abs(pdi14[-1]-ndi14[-1]))\n",
    "                            di14sum.append((pdi14[-1]+ndi14[-1]))\n",
    "                            xd.append(100*(di14diff[-1]/di14sum[-1]))\n",
    "                        if len(xd)==dmi_length:\n",
    "                            xda.append(sum(i for i in (xd))/dmi_length)\n",
    "                        if len(xda)>0:\n",
    "                            xda.append((xd[-1]+((dmi_length-1)*xda[-1]))/dmi_length)\n",
    "                        if len(xda)>=20:\n",
    "                            axda.append(np.mean(xda[-4:-1]))\n",
    "                        if len(pdi14)>2:\n",
    "                            if ((pdi14[-1]-ndi14[-1])>0 and (pdi14[-2]-ndi14[-2])<0) or ((pdi14[-1]-ndi14[-1])<0 and (pdi14[-2]-ndi14[-2])>0):\n",
    "                                if len(duration)==0:\n",
    "                                    duration_c+=1\n",
    "                                    duration.append(duration_c)\n",
    "                                    duration_c=0\n",
    "                                else:\n",
    "                                    duration.append(duration_c)\n",
    "                                    duration_c=0\n",
    "                            else:\n",
    "                                duration_c+=1\n",
    "                            \n",
    "                            \n",
    "                            \n",
    "                tot=100*profit-(2.37*number)+initial\n",
    "                \n",
    "                \n",
    "\n",
    "                waiting=0\n",
    "                \n",
    "                flag=0\n",
    "                tmpMAX=Maximum(maprice[-2880:])\n",
    "                tmpMIN=minimum(maprice[-2880:])\n",
    "                height=abs(tmpMAX-tmpMIN)\n",
    "                length=abs(maprice[-1]-tmpMIN)\n",
    "                if len(maprice)>1000:\n",
    "                    if (abs(maprice[-1]-tmpMIN)/height)<0.1 and height<13:\n",
    "                        flag=1\n",
    "                        #mode=1\n",
    "                    elif ((abs(maprice[-1]-tmpMAX)/height)<0.1 and height<13):\n",
    "                        flag=1\n",
    "                        #mode=1\n",
    "                    elif height>13:\n",
    "                        flag=1\n",
    "                        #mode=1\n",
    "                    else:\n",
    "                        flag=0\n",
    "                        #mode=2\n",
    "                        \n",
    "\n",
    "                    \n",
    "                        \n",
    "                            \n",
    "                            \n",
    "                if len(pdi14)>2 and len(duration)>1:# and 4 and len(dStochastic)>1:\n",
    "\n",
    "                    \n",
    "                    if  Position==0 and flag==1:# and counter<4:# and (Now[10:12]==\"10\" or Now[10:12]==\"09\" or Now[10:12]==\"22\" or Now[10:12]==\"23\" or Now[10:12]==\"00\" or Now[10:12]==\"01\" or Now[10:12]==\"02\" or Now[10:12]==\"03\" or Now[10:12]==\"04\" or Now[10:12]==\"08\"):\n",
    "                        if  duration[-1]>16 and ma[-1]>ma[-10] and (pdi14[-1]-ndi14[-1])>0 and (pdi14[-2]-ndi14[-2])<0:# and axda[-1]>25:#maprice[-1]>stop+4:\n",
    "                            mPosition=1\n",
    "                            mode=1\n",
    "                            print(\"mode 1 long in\")\n",
    "                            counter+=1\n",
    "                            n=abs(int(tot/5000))\n",
    "                            N=n\n",
    "                            if n==0:\n",
    "                                print(Now)\n",
    "                                print(tot)\n",
    "                                break\n",
    "\n",
    "                        if  duration[-1]>16 and ma[-1]>ma[-10] and (pdi14[-1]-ndi14[-1])<0 and (pdi14[-2]-ndi14[-2])>0 :#and axda[-1]>25:\n",
    "                            mPosition=-1\n",
    "                            mode=1\n",
    "                            print(\"mode 1 short in\")\n",
    "                            counter+=1\n",
    "                            n=abs(int(tot/5000))\n",
    "                            N=n\n",
    "                            mempro=tot\n",
    "                            if n==0:\n",
    "                                print(Now)\n",
    "                                print(tot)\n",
    "                                break\n",
    "                        if mode==0 and len(ATR)>4 and di14diff[-1]<di14diff[-5] and len(BB)>1:\n",
    "                            \n",
    "                            if ATR[-1]<ATR[-5] and maprice[-1]<ma[-1]-BB[-1] and BB[-1]<BB[-2] and pdi14[-1]>ndi14[-1] and dStochastic[-1]<50 and dStochastic[-1]>20 and kStochastic[-1]>dStochastic[-1]:\n",
    "                                mPosition=1\n",
    "                                mode=3\n",
    "                                print(\"mode 3 long in\")\n",
    "                                counter+=1\n",
    "                                n=abs(int(tot/5000))\n",
    "                                N=n\n",
    "                                if n==0:\n",
    "                                    print(Now)\n",
    "                                    print(tot)\n",
    "                                    break\n",
    "                            if ATR[-1]<ATR[-5] and maprice[-1]>ma[-1]+BB[-1] and BB[-1]<BB[-2] and pdi14[-1]<ndi14[-1] and  dStochastic[-1]>50 and dStochastic[-1]<80 and kStochastic[-1]<dStochastic[-1]:\n",
    "                                mPosition=-1\n",
    "                                mode=3\n",
    "                                print(\"mode 3 short in\")\n",
    "                                counter+=1\n",
    "                                n=abs(int(tot/5000))\n",
    "                                N=n\n",
    "                                if n==0:\n",
    "                                    print(Now)\n",
    "                                    print(tot)\n",
    "                                    break\n",
    "                if Position==0 and flag==0 and len(BB)>0 and len(ma)>=120:\n",
    "                \n",
    "\n",
    "                    if abs(maprice[-1]-ma1[-1])>1 and (abs(maprice[-1]-tmpMIN)/height)>0.1 and height<13 and ma[-1]<ma[-120]-0.1 and abs(maprice[-1]-ma[-1])<2*BB[-1] and abs(maprice[-10]-ma[-10])>2.1*BB[-10]:\n",
    "                        mPosition=1\n",
    "                        mode=2\n",
    "                        print(\"mode 2 long in\")\n",
    "                        stop=BB[-1]\n",
    "                        n=abs(int(tot/5000))\n",
    "                        N=n\n",
    "                        if n==0:\n",
    "                            print(Now)\n",
    "                            print(tot)\n",
    "                            break\n",
    "                \n",
    "\n",
    "                    if abs(maprice[-1]-ma1[-1])>1 and (abs(maprice[-1]-tmpMAX)/height)>0.1 and height<13 and ma[-1]>ma[-120]+0.1 and abs(maprice[-1]-ma[-1])<2*BB[-1] and abs(maprice[-10]-ma[-10])>2.1*BB[-10]:\n",
    "                        mPosition=-1\n",
    "                        print(\"mode 2 short in\")\n",
    "                        mode=2\n",
    "                        stop=BB[-1]\n",
    "                        n=abs(int(tot/5000))\n",
    "                        N=n\n",
    "                        if n==0:\n",
    "                            print(Now)\n",
    "                            print(tot)\n",
    "                            break\n",
    "                            \n",
    "                if Position>0 and mode==2:\n",
    "                    if (ma[-1]>ma[-120] or (Bid_k-mem)<-2*stop):\n",
    "                        print(\"HHHHHHHHHHHHHHHHHHHHHHHHHHHH\")\n",
    "                        mPosition=0\n",
    "                        mode=0\n",
    "                        if (Bid_k-mem)>0:\n",
    "                            Pro.append((Bid_k-mem)/(tot/100))\n",
    "                            Win+=1\n",
    "                        elif (Bid_k-mem)<0:\n",
    "                            Pro.append((Bid_k-mem)/(tot/100))\n",
    "                            Los+=1\n",
    "                            print(\"###\")\n",
    "                        else:\n",
    "                            Neutral+=1\n",
    "                            Pro.append((Bid_k-mem)/(tot/100))\n",
    "\n",
    "                    if (Bid_k-mem)<MDD:\n",
    "                        MDD=(Bid_k-mem)\n",
    "                    \n",
    "                    \n",
    "                if Position<0 and mode==2:\n",
    "                    if (ma[-1]<ma[-120] or (mem-Ask_k)<-2*stop):\n",
    "                        print(\"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF\")\n",
    "                        mPosition=0\n",
    "                        mode=0\n",
    "                        if (mem-Ask_k)>0:\n",
    "                            Pro.append(((mem-Ask_k))/(tot/100))\n",
    "                            Win+=1\n",
    "                        elif (mem-Ask_k)<0:\n",
    "                            Pro.append(((mem-Ask_k))/(tot/100))\n",
    "                            Los+=1\n",
    "                            print(\"###\")\n",
    "                        else:\n",
    "                            Neutral+=1\n",
    "                            Pro.append(((mem-Ask_k))/(tot/100))\n",
    "                    \n",
    "                    if (mem-Ask_k)<MDD:\n",
    "                        MDD=(mem-Ask_k)  \n",
    "                if Position>0 and (mode==1):# or mode==3):# and (Now[10:12]==\"21\"  or Now[10:12]==\"23\" or Now[10:12]==\"02\" or Now[10:12]==\"04\" or Now[10:12]==\"05\"):# or Now[10:12]==\"06\" or Now[10:12]==\"07\" or Now[10:12]==\"08\"):\n",
    "                   \n",
    "                    if  Bid_k-mem<-16 or Bid_k-mem>4:#maprice[-1]<(Minnn+Maxxx)/2:\n",
    "                        mPosition=0\n",
    "                        mode=0\n",
    "                        waiting=1\n",
    "                        if (Bid_k-mem)>0:\n",
    "                            Pro.append((Bid_k-mem)/(tot/100))\n",
    "                            Win+=1\n",
    "                        elif (Bid_k-mem)<0:\n",
    "                            Pro.append((Bid_k-mem)/(tot/100))\n",
    "                            Los+=1\n",
    "                            print(\"###\")\n",
    "                        else:\n",
    "                            Neutral+=1\n",
    "                            Pro.append((Bid_k-mem)/(tot/100))\n",
    "\n",
    "                    if (Bid_k-mem)<MDD:\n",
    "                        MDD=(Bid_k-mem)\n",
    "                if Position>0 and (mode==3):# and (Now[10:12]==\"21\"  or Now[10:12]==\"23\" or Now[10:12]==\"02\" or Now[10:12]==\"04\" or Now[10:12]==\"05\"):# or Now[10:12]==\"06\" or Now[10:12]==\"07\" or Now[10:12]==\"08\"):\n",
    "                   \n",
    "                    if  Bid_k-mem<-4 or Bid_k-mem>4:#maprice[-1]<(Minnn+Maxxx)/2:\n",
    "                        mPosition=0\n",
    "                        mode=0\n",
    "                        waiting=1\n",
    "                        if (Bid_k-mem)>0:\n",
    "                            Pro.append((Bid_k-mem)/(tot/100))\n",
    "                            Win+=1\n",
    "                        elif (Bid_k-mem)<0:\n",
    "                            Pro.append((Bid_k-mem)/(tot/100))\n",
    "                            Los+=1\n",
    "                            print(\"###\")\n",
    "                        else:\n",
    "                            Neutral+=1\n",
    "                            Pro.append((Bid_k-mem)/(tot/100))\n",
    "\n",
    "                    if (Bid_k-mem)<MDD:\n",
    "                        MDD=(Bid_k-mem)\n",
    "                if Position<0 and (mode==1):# and (Now[10:12]==\"21\"  or Now[10:12]==\"23\" or Now[10:12]==\"02\" or Now[10:12]==\"04\" or Now[10:12]==\"05\"):# or Now[10:12]==\"06\" or Now[10:12]==\"07\" or Now[10:12]==\"08\"):\n",
    "                   \n",
    "                    if  mem-Ask_k<-16 or  mem-Ask_k>4:#maprice[-1]>(Minnn+Maxxx)/2:\n",
    "                        mPosition=0\n",
    "                        mode=0\n",
    "                        waiting=1\n",
    "                        if (mem-Ask_k)>0:\n",
    "                            Pro.append(((mem-Ask_k))/(tot/100))\n",
    "                            Win+=1\n",
    "                        elif (mem-Ask_k)<0:\n",
    "                            Pro.append(((mem-Ask_k))/(tot/100))\n",
    "                            Los+=1\n",
    "                            print(\"###\")\n",
    "                        else:\n",
    "                            Neutral+=1\n",
    "                            Pro.append(((mem-Ask_k))/(tot/100))\n",
    "                    \n",
    "                    if (mem-Ask_k)<MDD:\n",
    "                        MDD=(mem-Ask_k)  \n",
    "                if Position<0 and (mode==3):# and (Now[10:12]==\"21\"  or Now[10:12]==\"23\" or Now[10:12]==\"02\" or Now[10:12]==\"04\" or Now[10:12]==\"05\"):# or Now[10:12]==\"06\" or Now[10:12]==\"07\" or Now[10:12]==\"08\"):\n",
    "                   \n",
    "                    if  mem-Ask_k<-4 or  mem-Ask_k>4:#maprice[-1]>(Minnn+Maxxx)/2:\n",
    "                        mPosition=0\n",
    "                        mode=0\n",
    "                        waiting=1\n",
    "                        if (mem-Ask_k)>0:\n",
    "                            Pro.append(((mem-Ask_k))/(tot/100))\n",
    "                            Win+=1\n",
    "                        elif (mem-Ask_k)<0:\n",
    "                            Pro.append(((mem-Ask_k))/(tot/100))\n",
    "                            Los+=1\n",
    "                            print(\"###\")\n",
    "                        else:\n",
    "                            Neutral+=1\n",
    "                            Pro.append(((mem-Ask_k))/(tot/100))\n",
    "                    \n",
    "                    if (mem-Ask_k)<MDD:\n",
    "                        MDD=(mem-Ask_k) \n",
    "                if Position!=0:\n",
    "                    Pn.append(N)\n",
    "                i=i+1\n",
    "                \n",
    "                #print(Now[10:12])\n",
    "                ############################################################################## \n",
    "                if Position==0 and mPosition==1:\n",
    "                    print(Now)\n",
    "                    mem=Ask_k\n",
    "                    #print(Ask_k)\n",
    "                    print(1)\n",
    "                    number=number+N\n",
    "                    Position=1\n",
    "                    print(\"------------------------------\")\n",
    "                elif Position==0 and mPosition==-1:\n",
    "                    print(Now)\n",
    "                    mem=Bid_k\n",
    "                    #print(Bid_k)\n",
    "                    print(-1)\n",
    "                    number=number+N\n",
    "                    Position=-1\n",
    "                    print(\"------------------------------\")\n",
    "                elif Position==1 and mPosition==0:\n",
    "                    print(Now)\n",
    "                    profit=profit+(Bid_k-mem)*N\n",
    "                    number=number+N\n",
    "                    print(-1)\n",
    "                    Position=0\n",
    "                    print(\"------------------------------\")\n",
    "                elif Position==-1 and mPosition==0:\n",
    "                    print(Now)\n",
    "                    profit=profit+(mem-Ask_k)*N\n",
    "                    number=number+N\n",
    "                    print(1)\n",
    "                    Position=0\n",
    "                    print(\"------------------------------\")\n",
    "                elif Position==-1 and mPosition==1:\n",
    "                    profit=profit+(mem-Ask_k)*N\n",
    "                    number=number+N\n",
    "                    mem=Ask_k\n",
    "                    print(1)\n",
    "                    number=number+N\n",
    "                    Position=1\n",
    "                    print(\"------------------------------\")\n",
    "                elif Position==1 and mPosition==-1: \n",
    "                    print(Now)\n",
    "                    profit=profit+(Bid_k-mem)*N\n",
    "                    number=number+N\n",
    "                    print(-1)\n",
    "                    mem=Bid_k\n",
    "                    print(-1)\n",
    "                    number=number+N\n",
    "                    Position=-1\n",
    "                    print(\"------------------------------\")\n",
    "        c+=1\n",
    "        tot=100*profit-(2.37*number)+initial\n",
    "        \n",
    "    print(\"profit:\"+str(profit))  \n",
    "    print(\"number\"+str(number))\n",
    "    tot=100*profit-(2.37*number)\n",
    "    print(\"tot:\"+str(tot))\n",
    "    print(\"Position:\"+str(Position))\n",
    "    print(\"MDD:\"+str(MDD))\n",
    "    print(N)\n",
    "    print(\"Win:\"+str(Win))\n",
    "    print(\"Los:\"+str(Los))\n",
    "    print(\"Neutral:\"+str(Neutral))\n",
    "    print(\"Sharpe:\"+str((np.mean(Pro)*259)/(statistics.stdev(Pro)*math.sqrt(259))))\n",
    "    print(Now)\n",
    "    \n",
    "    return Pn\n",
    "Pro=[]\n",
    "l=run()\n",
    "#v3 60"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "672"
      ]
     },
     "execution_count": 3,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "14*4*12"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.5.2"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
